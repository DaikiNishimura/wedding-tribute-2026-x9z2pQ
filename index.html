<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bootstrap Forms</title>
    <link rel="stylesheet" href="app.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <meta name="robots" content="noindex,nofollow">
</head>

<body>
  <div id="loader">
      <div class="loader-content">
          <h1 class="loader-logo">Happy Wedding</h1>
          <p class="loader-sub">Akari & Rei</p>
          <div class="loader-line-container">
              <div class="loader-line"></div>
          </div>
      </div>
  </div>
  
  <section class="hero-section">
      <div id="flower-container"></div>
      <div class="hero-photo">
          <div class="slider-img active" style="background-image: url('main1.jpeg')"></div>
          <div class="slider-img" style="background-image: url('main2.jpeg')"></div>
          <div class="slider-img" style="background-image: url('main3.jpeg')"></div>
          
          <div class="hero-text">
              <h2>Happy Wedding</h2>
              <p>Akari & Rei</p>
          </div>
      </div>
  </section>

<section class="couple-message-section">
  <div class="message-row groom-row animate-trigger">
    <div class="flip-card">
      <div class="flip-card-inner">
        <div class="flip-card-front">
          <img src="rei.jpeg" alt="新郎 洋装">
          <div class="photo-label">Tuxedo</div>
        </div>
        <div class="flip-card-back">
          <img src="rei2.jpeg" alt="新郎 和装">
          <div class="photo-label">Wasou</div>
        </div>
      </div>
    </div>
    <div class="message-box right-slide">
      <h3>Rei</h3>
      <div class="message-text">
        <p>結婚式ではありがとうございました。皆様の笑顔を見れて、忘れられない思い出ができました。日頃の感謝の気持ちを込めて、あああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああ。</p>
      </div>
    </div>
  </div>

  <div class="message-row bride-row animate-trigger">
    <div class="message-box left-slide">
      <h3>Akari</h3>
      <div class="message-text">
        <p>結婚式ではありがとうございました。皆様の笑顔を見れて、忘れられない思い出ができました。日頃の感謝の気持ちを込めて、あああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああああ。</p>
      </div>
    </div>
    <div class="flip-card">
      <div class="flip-card-inner">
        <div class="flip-card-front">
          <img src="akari.jpeg" alt="新婦 洋装">
          <div class="photo-label">Dress</div>
        </div>
        <div class="flip-card-back">
          <img src="akari2.jpeg" alt="新婦 和装">
          <div class="photo-label">Wasou</div>
        </div>
      </div>
    </div>
  </div>
</section>

<section class="video-section">
    <div class="movie-header">
        <span class="movie-tag">Highlight Movie</span>
        <h3 class="movie-title">Our Special Day - 15s Memories</h3>
    </div>

    <div class="highlight-movie-container" style="width: 100%; max-width: 900px;">
        <video id="highlight-video" playsinline controls preload="metadata">
            <source src="highlight-movie.mov" type="video/mp4">
            ご使用のブラウザは動画再生に対応していません。
        </video>
    </div>

    <div id="video-thanks-message" class="video-thanks-hidden">
        <p class="thanks-title">Thank you for watching!</p>
        <p class="thanks-text">
            この15秒に収まりきらないほどの感謝を込めて。<br>
            これからも私たちをよろしくお願いします。
        </p>
    </div>
</section>

<section class="bgm-section">
    <button id="toggle-bgm" class="bgm-open-btn">
        <i class="fas fa-music"></i> 披露宴のBGMリストを見る
    </button>

    <div id="bgm-list-container" class="bgm-list-hidden">
        <ul class="bgm-list">
            <li class="bgm-item" data-scene="迎賓" data-music="曲名 / アーティスト名" data-desc="ゲストの皆様をお迎えする際に流しました。リラックスした雰囲気作りを意識しました。" data-img="geihin.jpeg">
                <span class="scene-tag">迎賓</span> 115万キロのフィルム / Official髭男dism
            </li>
            <li class="bgm-item" data-scene="新郎新婦入場" data-music="曲名 / アーティスト名" data-desc="一番こだわった入場曲です！扉が開く瞬間の高揚感を大切にしました。" data-img="nyujyou.jpeg">
                <span class="scene-tag">入場</span> 君の好きなとこ / 平井堅
            </li>
            <li class="bgm-item" data-scene="お見送り" data-music="曲名 / アーティスト名" data-desc="今日一日の感謝を込めて。爽やかな気分で帰路についていただけるように選びました。" data-img="omiokuri.jpeg">
                <span class="scene-tag">送賓</span> Marry You / ブルーノ・マーズ
            </li>
        </ul>
        <!-- <ul class="bgm-list">
          <li class="bgm-item">
            <div class="bgm-icon">♪</div>
            <div class="bgm-info">
              <span class="bgm-title">曲名が入ります</span>
              <span class="bgm-artist">アーティスト名</span>
            </div>
          </li>
          <li class="bgm-item">
            <div class="bgm-icon">♪</div>
            <div class="bgm-info">
              <span class="bgm-title">もう一つの曲名</span>
              <span class="bgm-artist">アーティスト名</span>
            </div>
          </li>
        </ul> -->
    </div>
</section>

<div id="bgm-modal" class="modal">
    <div class="modal-content bgm-modal-content">
        <span class="close-bgm-modal">&times;</span>
        <div id="bgm-modal-bg" class="modal-bg-img">
            <div class="modal-overlay">
                <h3 id="bgm-modal-scene"></h3>
                <h4 id="bgm-modal-title"></h4>
                <p id="bgm-modal-desc"></p>
            </div>
        </div>
    </div>
</div>

<section class="googlephoto-section">
  <div class="photo-share-container">
    <a href="https://photos.app.goo.gl/7codNTYrmmb6Xaqt8" target="_blank" class="photo-share-btn">
      <!--<i class="fas fa-image google-icon"></i> <span>当日の写真を共有する</span>-->
      <!--<i class="fas fa-images google-icon"></i> <span>当日の写真を共有する</span>-->
      <i class="fas fa-camera google-icon"></i> <span>当日の写真を共有する</span>
      <!--<i class="fas fa-cloud-upload-alt google-icon"></i> <span>当日の写真を共有する</span>-->
    </a>
    <p class="photo-share-note">※皆様が撮影したお写真をアップロードいただけると嬉しいです！</p>
  </div>
</section>

<script src="app.js"></script>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { push } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
  import { getDatabase, ref, onValue, set, runTransaction } 
    from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

  // あなたのプロジェクト設定（Firebaseコンソールの「プロジェクト設定」＞「マイアプリ」から取得）
  const firebaseConfig = {
    apiKey: "AIzaSyCw28qvMsfoQ7ii59RwvquQqERe8wugHGc",
    authDomain: "wedding-likes.firebaseapp.com",
    databaseURL: "https://wedding-likes-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "wedding-likes",
    storageBucket: "wedding-likes.firebasestorage.app",
    messagingSenderId: "272973159971",
    appId: "1:272973159971:web:db5b18641e3de842c49b96",
    measurementId: "G-QX5JXNS099"
  };

  // Firebase初期化
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const likesRef = ref(db, 'likes_count');

  const likeCountElement = document.getElementById('like-count');
  const likeBtn = document.getElementById('like-btn');

  // 3. データのリアルタイム受信
  onValue(likesRef, (snapshot) => {
    const data = snapshot.val();
    likeCountElement.innerText = data || 124; // データがなければ初期値
  });

  // 4. クリック時のカウントアップ処理（トランザクション）
  likeBtn.addEventListener('click', () => {
    runTransaction(likesRef, (currentCount) => {
      // 現在の値を取り込み、数値でなければ124（初期値）にする
      const count = parseInt(currentCount) || 124;
      return count + 1;
    });

    // windowに登録した演出を呼び出す
    if (typeof window.createFloatingHeart === 'function') {
      window.createFloatingHeart();
    }
  });

  const commentsRef = ref(db, 'comments');
  const nameInput = document.getElementById('guest-name');
  const messageInput = document.getElementById('guest-message');
  const submitBtn = document.getElementById('submit-comment');
  const displayArea = document.getElementById('comments-display');

  // 投稿ボタンクリック
  submitBtn.addEventListener('click', () => {
    const name = nameInput.value.trim() || "匿名ゲスト";
    const text = messageInput.value.trim();

    if (text) {
      // 1. Firebaseに保存
      push(commentsRef, { name, text, timestamp: Date.now() });

      // 2. キーワードチェック（おめでとう、祝、Happy、お幸せに、など）
      const keywords = ["おめでとう", "祝", "happy", "お幸せに", "おめ"];
      const isCelebration = keywords.some(key => text.toLowerCase().includes(key));

      if (isCelebration) {
        launchCelebration(); // 特別な演出を実行
      }

      messageInput.value = ''; // 入力欄をクリア
    }
  });

  // コメントをリアルタイムで受信して表示
  onValue(commentsRef, (snapshot) => {
    displayArea.innerHTML = ''; // 一旦クリア
    const data = snapshot.val();
    if (data) {
      Object.values(data).forEach(comment => {
        const div = document.createElement('div');
        div.className = 'comment-item';
        const date = new Date(comment.timestamp).toLocaleString();
        div.innerHTML = `
          <span class="name">@${comment.name}</span>
          <p class="text">${comment.text}</p>
          <span class="date">${date}</span>
        `;
        displayArea.appendChild(div);
      });
    }
  });

  // 投稿機能
  submitBtn.addEventListener('click', () => {
    const name = nameInput.value.trim() || "匿名ゲスト";
    const text = messageInput.value.trim();

    if (text) {
      push(commentsRef, {
        name: name,
        text: text,
        timestamp: Date.now()
      });
      messageInput.value = ''; // 入力欄をクリア
    }
  });

  // 表示機能 (Threads風にHTMLを組み立て)
  onValue(commentsRef, (snapshot) => {
    displayArea.innerHTML = '';
    const data = snapshot.val();
    if (data) {
      // 新しい順に並べるため配列にしてリバース
      const entries = Object.values(data).reverse();
      entries.forEach(comment => {
        const div = document.createElement('div');
        div.className = 'comment-item';
        const timeStr = new Date(comment.timestamp).toLocaleDateString();
        div.innerHTML = `
          <div class="user-avatar" style="background:#f0f0f0; display:flex; align-items:center; justify-content:center; font-size:10px;">User</div>
          <div class="comment-content">
            <div class="comment-author">${comment.name}</div>
            <p class="comment-text">${comment.text}</p>
            <span class="comment-date">${timeStr}</span>
          </div>
        `;
        displayArea.appendChild(div);
      });
    }
  });
</script>

<section class="comments-full-section"> 
  <div class="threads-container">
    <div class="comment-input-card">
      <div class="input-header">
        <img src="main1.jpeg" class="user-avatar" alt="me">
        <span class="user-name">Guest</span>
      </div>
      <textarea id="guest-message" placeholder="新郎新婦にお祝いメッセージを書く..."></textarea>
      <div class="input-footer">
        <input type="text" id="guest-name" placeholder="お名前">
        <button id="submit-comment" class="threads-post-btn">投稿</button>
      </div>
    </div>
    <div id="comments-display" class="threads-feed">
    </div>
  </div>
</section>
</body>

</html>