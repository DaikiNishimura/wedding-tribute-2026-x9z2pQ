<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bootstrap Forms</title>
    <link rel="stylesheet" href="app.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <meta name="robots" content="noindex,nofollow">
</head>

<body>
    <section class="hero-section">
  <div id="flower-container"></div>
  <div class="hero-photo">
    <div class="slider-img active" style="background-image: url('main1.jpeg');"></div>
    <div class="slider-img" style="background-image: url('main2.jpeg');"></div>
    <div class="slider-img" style="background-image: url('main3.jpeg');"></div>
    <div class="hero-text">
      <h2>Happy Wedding</h2>
      <p>Akari & Rei</p>
    </div>
  </div>
</section>

<section class="action-area">
  <div class="like-container">
    <button id="like-btn" class="like-button">
      <span class="heart">❤</span> おめでとう！
    </button>
    <div class="counter-box">
      <span id="like-count" class="count">124</span>
      <span class="count-unit">人がお祝いしています</span>
    </div>
  </div>
</section>

<section>
  <div class="photo-share-container">
    <a href="https://photos.app.goo.gl/7codNTYrmmb6Xaqt8" target="_blank" class="photo-share-btn">
      <!--<i class="fas fa-image google-icon"></i> <span>当日の写真を共有する</span>-->
      <!--<i class="fas fa-images google-icon"></i> <span>当日の写真を共有する</span>-->
      <i class="fas fa-camera google-icon"></i> <span>当日の写真を共有する</span>
      <!--<i class="fas fa-cloud-upload-alt google-icon"></i> <span>当日の写真を共有する</span>-->
    </a>
    <p class="photo-share-note">※皆様が撮影したお写真をアップロードいただけると嬉しいです！</p>
  </div>
</section>

<div class="couple-messages-container">
  <div class="message-card-wrapper">
    <div class="message-card groom-card" onclick="this.classList.toggle('is-flipped')">
      <div class="card-face card-front">
        <div class="inner-frame"> <img src="rei.jpeg" alt="新郎">
        </div>
        <div class="card-label">Groom</div>
      </div>
      <div class="card-face card-back">
        <div class="back-content">
          <h3>To Guests</h3>
          <p>本日はありがとうございます！</p>
        </div>
      </div>
    </div>
  </div>

  <div class="message-card-wrapper">
    <div class="message-card bride-card" onclick="this.classList.toggle('is-flipped')">
      <div class="card-face card-front">
        <div class="inner-frame"> <img src="akari.jpeg" alt="新婦">
        </div>
        <div class="card-label">Bride</div>
      </div>
      <div class="card-face card-back">
        <div class="back-content">
          <h3>To Guests</h3>
          <p>最高の一日になりました！</p>
        </div>
      </div>
    </div>
  </div>
</div>

<section class="bgm-section">
    <button id="toggle-bgm" class="bgm-open-btn">
        <i class="fas fa-music"></i> 披露宴のBGMリストを見る
    </button>

    <div id="bgm-list-container" class="bgm-list-hidden">
        <ul class="bgm-list">
            <li class="bgm-item" data-scene="迎賓" data-music="曲名 / アーティスト名" data-desc="ゲストの皆様をお迎えする際に流しました。リラックスした雰囲気作りを意識しました。" data-img="geihin.jpeg">
                <span class="scene-tag">迎賓</span> 曲名 / アーティスト名
            </li>
            <li class="bgm-item" data-scene="新郎新婦入場" data-music="曲名 / アーティスト名" data-desc="一番こだわった入場曲です！扉が開く瞬間の高揚感を大切にしました。" data-img="nyujyou.jpeg">
                <span class="scene-tag">入場</span> 曲名 / アーティスト名
            </li>
            <li class="bgm-item" data-scene="お見送り" data-music="曲名 / アーティスト名" data-desc="今日一日の感謝を込めて。爽やかな気分で帰路についていただけるように選びました。" data-img="omiokuri.jpeg">
                <span class="scene-tag">送賓</span> 曲名 / アーティスト名
            </li>
        </ul>
    </div>
</section>

<div id="bgm-modal" class="modal">
    <div class="modal-content bgm-modal-content">
        <span class="close-bgm-modal">&times;</span>
        <div id="bgm-modal-bg" class="modal-bg-img">
            <div class="modal-overlay">
                <h3 id="bgm-modal-scene"></h3>
                <h4 id="bgm-modal-title"></h4>
                <p id="bgm-modal-desc"></p>
            </div>
        </div>
    </div>
</div>

<section>
    <div class="timeline">
        <div class="timeline-item">
            <div class="timeline-date">2021.04</div>
                <div class="timeline-content">
                <h3>社会人としてのスタート</h3>
                <p>エンジニアとしてのキャリアを開始。基礎を叩き込む日々。</p>
                </div>
        </div>

        <div class="timeline-item">
            <div class="timeline-date">2023.06</div>
            <div class="timeline-content card-flip">
                <div class="card-front">
                <h3><i class="fas fa-birthday-cake"></i> 初めての誕生日</h3>
                <p>クリックして思い出を見る</p>
                </div>
            </div>
        </div>

        <div class="timeline-item">
            <div class="timeline-date">2024.10</div>
            <div class="timeline-content">
                <h3>大きな人生の転機</h3>
                <p>成長の機会</p>
            </div>
        </div>

        <div class="timeline-item">
            <div class="timeline-date">2025.09</div>
            <div class="timeline-content card-flip">
                <div class="card-front">
                    <h3>ダブルダッチ優勝</h3>
                    <p>please touch here</p>
                </div>
                <div class="card-back">
                    <img src="2025-11-15_18-00-44_650.jpeg" alt="思い出の写真">
                    <p>最高の景色</p>
                </div>
            </div>
        </div>

        <div class="timeline-item">
            <div class="timeline-date">2025.12</div>
            <div class="timeline-content card-flip">
                <div class="card-front">
                    <h3><i class="fas fa-ring"></i> プロポーズ</h3>
                    <p>最高の瞬間でした</p>
                </div>
            </div>
        </div>
    </div>
</section>

<div class="relation-map">
  <div class="node center">
    <div class="label">あなた</div>
  </div>

  <div class="node-group">
    <div class="node partner">彼女</div>
    <div class="node family">家族</div>
    <div class="node friends">友人</div>
    <div class="node relatives">親戚</div>
    <div class="node colleagues">会社の同僚</div>
  </div>

  <div class="lines"></div>
</div>
<div id="message-modal" class="modal">
  <div class="modal-content">
    <span class="close-btn">&times;</span>
    <h3 id="modal-name"></h3> <p id="modal-text"></p>
   </div>
</div>
<script src="app.js"></script>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { push } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
  import { getDatabase, ref, onValue, set, runTransaction } 
    from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

  // あなたのプロジェクト設定（Firebaseコンソールの「プロジェクト設定」＞「マイアプリ」から取得）
  const firebaseConfig = {
    apiKey: "AIzaSyCw28qvMsfoQ7ii59RwvquQqERe8wugHGc",
    authDomain: "wedding-likes.firebaseapp.com",
    databaseURL: "https://wedding-likes-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "wedding-likes",
    storageBucket: "wedding-likes.firebasestorage.app",
    messagingSenderId: "272973159971",
    appId: "1:272973159971:web:db5b18641e3de842c49b96",
    measurementId: "G-QX5JXNS099"
  };

  // Firebase初期化
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const likesRef = ref(db, 'likes_count');

  const likeCountElement = document.getElementById('like-count');
  const likeBtn = document.getElementById('like-btn');

  // 3. データのリアルタイム受信
  onValue(likesRef, (snapshot) => {
    const data = snapshot.val();
    likeCountElement.innerText = data || 124; // データがなければ初期値
  });

  // 4. クリック時のカウントアップ処理（トランザクション）
  likeBtn.addEventListener('click', () => {
    runTransaction(likesRef, (currentCount) => {
      // 現在の値を取り込み、数値でなければ124（初期値）にする
      const count = parseInt(currentCount) || 124;
      return count + 1;
    });

    // windowに登録した演出を呼び出す
    if (typeof window.createFloatingHeart === 'function') {
      window.createFloatingHeart();
    }
  });

  const commentsRef = ref(db, 'comments');
  const nameInput = document.getElementById('guest-name');
  const messageInput = document.getElementById('guest-message');
  const submitBtn = document.getElementById('submit-comment');
  const displayArea = document.getElementById('comments-display');

  // 投稿ボタンクリック
  submitBtn.addEventListener('click', () => {
    const name = nameInput.value.trim() || "匿名ゲスト";
    const text = messageInput.value.trim();

    if (text) {
      // 1. Firebaseに保存
      push(commentsRef, { name, text, timestamp: Date.now() });

      // 2. キーワードチェック（おめでとう、祝、Happy、お幸せに、など）
      const keywords = ["おめでとう", "祝", "happy", "お幸せに", "おめ"];
      const isCelebration = keywords.some(key => text.toLowerCase().includes(key));

      if (isCelebration) {
        launchCelebration(); // 特別な演出を実行
      }

      messageInput.value = ''; // 入力欄をクリア
    }
  });

  // コメントをリアルタイムで受信して表示
  onValue(commentsRef, (snapshot) => {
    displayArea.innerHTML = ''; // 一旦クリア
    const data = snapshot.val();
    if (data) {
      Object.values(data).forEach(comment => {
        const div = document.createElement('div');
        div.className = 'comment-item';
        const date = new Date(comment.timestamp).toLocaleString();
        div.innerHTML = `
          <span class="name">@${comment.name}</span>
          <p class="text">${comment.text}</p>
          <span class="date">${date}</span>
        `;
        displayArea.appendChild(div);
      });
    }
  });

  // 投稿機能
  submitBtn.addEventListener('click', () => {
    const name = nameInput.value.trim() || "匿名ゲスト";
    const text = messageInput.value.trim();

    if (text) {
      push(commentsRef, {
        name: name,
        text: text,
        timestamp: Date.now()
      });
      messageInput.value = ''; // 入力欄をクリア
    }
  });

  // 表示機能 (Threads風にHTMLを組み立て)
  onValue(commentsRef, (snapshot) => {
    displayArea.innerHTML = '';
    const data = snapshot.val();
    if (data) {
      // 新しい順に並べるため配列にしてリバース
      const entries = Object.values(data).reverse();
      entries.forEach(comment => {
        const div = document.createElement('div');
        div.className = 'comment-item';
        const timeStr = new Date(comment.timestamp).toLocaleDateString();
        div.innerHTML = `
          <div class="user-avatar" style="background:#f0f0f0; display:flex; align-items:center; justify-content:center; font-size:10px;">User</div>
          <div class="comment-content">
            <div class="comment-author">${comment.name}</div>
            <p class="comment-text">${comment.text}</p>
            <span class="comment-date">${timeStr}</span>
          </div>
        `;
        displayArea.appendChild(div);
      });
    }
  });
</script>

<section class="threads-container">
  <div class="comment-input-card">
    <div class="input-header">
      <img src="2025-05-23_15-58-47_030.jpeg" class="user-avatar" alt="me">
      <span class="user-name">Guest</span>
    </div>
    <textarea id="guest-message" placeholder="新郎新婦にお祝いメッセージを書く..."></textarea>
    <div class="input-footer">
      <input type="text" id="guest-name" placeholder="お名前">
      <button id="submit-comment" class="threads-post-btn">投稿</button>
    </div>
  </div>

  <div id="comments-display" class="threads-feed">
    </div>
</section>

</body>

</html>